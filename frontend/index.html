<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlackBook Prediction Market - Testing Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .header-top {
            text-align: center;
            padding: 20px;
            color: #333;
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
            position: relative;
        }

        .header-top h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-top p {
            font-size: 1.1rem;
            opacity: 0.8;
            color: #666;
        }

        .account-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 8px;
        }

        .current-account-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 200px;
            justify-content: space-between;
        }

        .current-account-display:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .account-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            min-width: 280px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .account-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .account-option {
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .account-option:last-child {
            border-bottom: none;
            border-radius: 0 0 15px 15px;
        }

        .account-option:first-child {
            border-radius: 15px 15px 0 0;
        }

        .account-option:hover {
            background: #f8f9ff;
            color: #667eea;
        }

        .account-option.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .account-name {
            font-weight: 600;
        }

        .account-balance {
            font-size: 0.9rem;
            color: #27ae60;
        }

        .account-option.selected .account-balance {
            color: rgba(255,255,255,0.9);
        }

        .nav-menu {
            display: flex;
            justify-content: center;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 0 0 15px 15px;
        }

        .nav-item {
            padding: 15px 30px;
            cursor: pointer;
            font-weight: 600;
            color: #667eea;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .nav-item:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #5a67d8;
        }

        .nav-item.active {
            background: rgba(102, 126, 234, 0.15);
            border-bottom-color: #667eea;
            color: #5a67d8;
        }

        .nav-item i {
            margin-right: 8px;
        }

        .main-content {
            margin-top: 20px;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .accounts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .marketplace-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }

        .market-categories {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .market-list {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .accounts-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .accounts-panel h2 {
            margin-bottom: 20px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .account-card {
            background: #f8f9ff;
            border: 2px solid #e0e6ff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .account-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .account-card.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .account-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .account-name {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .account-balance {
            font-size: 1.2rem;
            font-weight: bold;
            color: #27ae60;
        }

        .category-item {
            padding: 12px 15px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .category-item:hover {
            background: #f8f9ff;
            border-left-color: #667eea;
        }

        .category-item.active {
            background: #667eea;
            color: white;
            border-left-color: #5a67d8;
        }

        .market-card {
            background: #f8f9ff;
            border: 2px solid #e0e6ff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .market-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-color: #667eea;
        }

        .market-title {
            font-weight: bold;
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: #333;
        }

        .market-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .market-outcomes {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .outcome-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .outcome-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .outcome-odds {
            background: rgba(255,255,255,0.2);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .account-card.active .account-balance {
            color: #ecf0f1;
        }

        .markets-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .markets-panel h2 {
            margin-bottom: 20px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .market-card {
            background: #f8f9ff;
            border: 2px solid #e0e6ff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .market-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .market-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .market-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e6ff;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }

        .outcomes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .outcome-card {
            background: white;
            border: 2px solid #e0e6ff;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .outcome-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .outcome-name {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .outcome-odds {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .outcome-probability {
            color: #666;
            font-size: 0.9rem;
        }

        .bet-controls {
            background: #f0f2ff;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .bet-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }

        .bet-input {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e6ff;
            border-radius: 8px;
            font-size: 1rem;
        }

        .bet-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .bet-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .bet-button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .bet-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .admin-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 20px;
        }

        .admin-panel h2 {
            margin-bottom: 20px;
            color: #333;
            border-bottom: 2px solid #e74c3c;
            padding-bottom: 10px;
        }

        .admin-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .admin-button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .admin-button:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .success-message {
            background: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
        }

        .error-message {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
        }

        .loading {
            opacity: 0.7;
            pointer-events: none;
        }

        .category-tag {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-bottom: 10px;
        }

        .potential-payout {
            background: #27ae60;
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            margin-left: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation Header -->
        <div class="header">
            <div class="header-top">
                <h1>üèÜ BlackBook Prediction Market</h1>
                <p>Professional Prediction Markets with ObjectWire Intelligence Integration</p>
                
                <!-- Account Selector in Top Right -->
                <div class="account-selector">
                    <div class="current-account-display" onclick="toggleAccountDropdown()">
                        <div>
                            <div id="current-account-name">Tech Analyst</div>
                            <div id="current-account-balance" style="font-size: 0.8rem; opacity: 0.9;">2,625 BB</div>
                        </div>
                        <div id="dropdown-arrow">‚ñº</div>
                    </div>
                    <div class="account-dropdown" id="account-dropdown">
                        <!-- Account options will be populated by JavaScript -->
                    </div>
                </div>
            </div>
            <div class="nav-menu">
                <div class="nav-item active" data-section="accounts">
                    <i>üë•</i> Accounts
                </div>
                <div class="nav-item" data-section="marketplace">
                    <i>üìä</i> Marketplace
                </div>
                <div class="nav-item" data-section="objectwire">
                    <i>üì∞</i> ObjectWire
                </div>
                <div class="nav-item" data-section="admin">
                    <i>‚öôÔ∏è</i> Admin
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Accounts Section -->
            <div id="accounts-section" class="content-section active">
                <h2 style="color: white; text-align: center; margin-bottom: 20px;">
                    üë• God Mode Account Management
                </h2>
                <div class="accounts-grid">
                    <div class="accounts-panel">
                        <h3>üéÆ Active Accounts</h3>
                        <div id="accounts-list">
                            <!-- Accounts will be populated by JavaScript -->
                        </div>
                    </div>
                    <div class="accounts-panel">
                        <h3>ÔøΩ Account Actions</h3>
                        <div id="account-actions">
                            <div class="action-group">
                                <h4>Transfer BB Tokens</h4>
                                <select id="transfer-from">
                                    <option value="">Select sender...</option>
                                </select>
                                <select id="transfer-to">
                                    <option value="">Select receiver...</option>
                                </select>
                                <input type="number" id="transfer-amount" placeholder="Amount (BB)" min="1">
                                <button onclick="transferTokens()">Transfer</button>
                            </div>
                            <div class="action-group">
                                <h4>Add Balance</h4>
                                <select id="balance-account">
                                    <option value="">Select account...</option>
                                </select>
                                <input type="number" id="balance-amount" placeholder="Amount (BB)" min="1">
                                <button onclick="addBalance()">Add Balance</button>
                            </div>
                        </div>
                    </div>
                    <div class="accounts-panel">
                        <h3>üìà Account Stats</h3>
                        <div id="account-stats">
                            <!-- Stats will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Marketplace Section -->
            <div id="marketplace-section" class="content-section">
                <h2 style="color: white; text-align: center; margin-bottom: 20px;">
                    üìä Prediction Marketplace
                </h2>
                <div class="marketplace-grid">
                    <div class="market-categories">
                        <h3>üìÇ Market Categories</h3>
                        <div class="category-item active" data-category="all">
                            üåê All Markets
                        </div>
                        <div class="category-item" data-category="tech">
                            üíª Technology
                        </div>
                        <div class="category-item" data-category="policy">
                            üèõÔ∏è Policy & Regulation
                        </div>
                        <div class="category-item" data-category="economics">
                            üìä Economics
                        </div>
                        <div class="category-item" data-category="corporate">
                            üè¢ Corporate Actions
                        </div>
                        <div class="category-item" data-category="geopolitical">
                            üåç Geopolitical
                        </div>
                        <div class="category-item" data-category="live">
                            üöÄ Live Markets
                        </div>
                        <div class="category-item" data-category="objectwire">
                            üì∞ ObjectWire
                        </div>
                        <div class="category-item" data-category="tech-events">
                            üéØ Real Tech Events
                        </div>
                    </div>
                    <div class="market-list">
                        <h3>üéØ Active Markets</h3>
                        <div id="markets-list">
                            <!-- Markets will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- ObjectWire Section -->
            <div id="objectwire-section" class="content-section">
                <h2 style="color: white; text-align: center; margin-bottom: 20px;">
                    ÔøΩ ObjectWire Intelligence Markets
                </h2>
                <div class="main-grid">
                    <div class="accounts-panel">
                        <h3>üîÑ Sync Controls</h3>
                        <button onclick="syncObjectWire()" style="width: 100%; margin-bottom: 15px;">
                            Sync ObjectWire Articles
                        </button>
                        <div id="objectwire-status">
                            <!-- Status will be updated by JavaScript -->
                        </div>
                    </div>
                    <div class="accounts-panel">
                        <h3>üìä ObjectWire Markets</h3>
                        <div id="objectwire-markets">
                            <!-- ObjectWire markets will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tech Events Section -->
            <div id="tech-events-section" class="content-section">
                <h2 style="color: white; text-align: center; margin-bottom: 20px;">
                    üéØ Real Tech Events & Crypto Predictions
                </h2>
                <div class="main-grid">
                    <div class="accounts-panel">
                        <h3>üì° Data Sources</h3>
                        <button onclick="fetchTechEvents()" style="width: 100%; margin-bottom: 10px; background: #4CAF50; color: white;">
                            Fetch Google News Tech Events
                        </button>
                        <button onclick="syncTechEvents()" style="width: 100%; margin-bottom: 15px; background: #2196F3; color: white;">
                            Sync Top 100 Events
                        </button>
                        <div id="tech-events-status" style="padding: 10px; background: #1e1e1e; border-radius: 5px; color: #ccc;">
                            Status: Ready to sync
                        </div>
                    </div>
                    <div class="accounts-panel">
                        <h3>‚ö° Live Crypto Betting (15min intervals)</h3>
                        <div class="crypto-betting">
                            <div style="margin-bottom: 10px;">
                                <strong>üü† Bitcoin Price</strong>
                                <div id="btc-price" style="color: #ff9500; font-size: 1.2em;">$--,---</div>
                                <button onclick="placeCryptoBet('BTC', 'up')" style="background: #4CAF50; color: white; margin: 2px;">BTC ‚ÜóÔ∏è</button>
                                <button onclick="placeCryptoBet('BTC', 'down')" style="background: #f44336; color: white; margin: 2px;">BTC ‚ÜòÔ∏è</button>
                            </div>
                            <div style="margin-bottom: 15px;">
                                <strong>üü£ Solana Price</strong>
                                <div id="sol-price" style="color: #9945FF; font-size: 1.2em;">$---.--</div>
                                <button onclick="placeCryptoBet('SOL', 'up')" style="background: #4CAF50; color: white; margin: 2px;">SOL ‚ÜóÔ∏è</button>
                                <button onclick="placeCryptoBet('SOL', 'down')" style="background: #f44336; color: white; margin: 2px;">SOL ‚ÜòÔ∏è</button>
                            </div>
                            <div id="crypto-bets-status" style="padding: 8px; background: #2a2a2a; border-radius: 4px; font-size: 0.9em;">
                                Next resolution in: --:--
                            </div>
                        </div>
                    </div>
                    <div class="accounts-panel" style="grid-column: 1 / -1;">
                        <h3>üìä Top Tech Events Markets</h3>
                        <div id="tech-events-markets" style="max-height: 400px; overflow-y: auto;">
                            <!-- Tech events markets will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Section -->
            <div id="admin-section" class="content-section">
                <h2 style="color: white; text-align: center; margin-bottom: 20px;">
                    ‚öôÔ∏è System Administration
                </h2>
                <div class="accounts-panel">
                    <h3>üéÆ System Controls</h3>
                    <div class="admin-controls">
                        <button class="admin-button" onclick="createSampleMarkets()">Create Sample Markets</button>
                        <button class="admin-button" onclick="distributeTokens()">Distribute BB Tokens</button>
                        <button class="admin-button" onclick="resetAllBalances()">Reset All Balances</button>
                        <button class="admin-button" onclick="exportTestData()">Export Test Data</button>
                        <button class="admin-button" onclick="resolveAllMarkets()">Resolve Markets</button>
                        <button class="admin-button" onclick="refreshData()">Refresh Data</button>
                    </div>
                </div>
                <div class="accounts-panel">
                    <h3>üìä System Stats</h3>
                    <div id="system-stats">
                        <!-- System statistics will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="status-messages" style="position: fixed; top: 20px; right: 20px; z-index: 1000;">
            <!-- Status messages will appear here -->
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE = 'http://localhost:3000';
        const TOTAL_BB_TOKENS = 21000;

        // Navigation Management
        function initNavigation() {
            const navItems = document.querySelectorAll('.nav-item');
            const sections = document.querySelectorAll('.content-section');

            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    const targetSection = item.getAttribute('data-section');
                    
                    // Update active nav item
                    navItems.forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                    
                    // Show target section
                    sections.forEach(section => section.classList.remove('active'));
                    document.getElementById(`${targetSection}-section`).classList.add('active');

                    // Load section-specific data
                    loadSectionData(targetSection);
                });
            });

            // Initialize account selector
            initAccountSelector();
            
            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.account-selector')) {
                    closeAccountDropdown();
                }
            });
        }

        // Account Selector Management
        function initAccountSelector() {
            populateAccountDropdown();
            updateCurrentAccountDisplay();
        }

        function populateAccountDropdown() {
            const dropdown = document.getElementById('account-dropdown');
            if (!dropdown) return;

            let html = '';
            TEST_ACCOUNTS.forEach(account => {
                const isSelected = account.id === currentAccount.id;
                html += `
                    <div class="account-option ${isSelected ? 'selected' : ''}" 
                         onclick="selectAccountFromDropdown(${account.id})" 
                         data-account-id="${account.id}">
                        <div class="account-name">${account.name}</div>
                        <div class="account-balance">${account.balance.toLocaleString()} BB</div>
                    </div>
                `;
            });
            dropdown.innerHTML = html;
        }

        function updateCurrentAccountDisplay() {
            const nameEl = document.getElementById('current-account-name');
            const balanceEl = document.getElementById('current-account-balance');
            
            if (nameEl) nameEl.textContent = currentAccount.name;
            if (balanceEl) balanceEl.textContent = `${currentAccount.balance.toLocaleString()} BB`;
        }

        function toggleAccountDropdown() {
            const dropdown = document.getElementById('account-dropdown');
            const arrow = document.getElementById('dropdown-arrow');
            
            if (dropdown.classList.contains('active')) {
                closeAccountDropdown();
            } else {
                dropdown.classList.add('active');
                arrow.textContent = '‚ñ≤';
                populateAccountDropdown(); // Refresh balances
            }
        }

        function closeAccountDropdown() {
            const dropdown = document.getElementById('account-dropdown');
            const arrow = document.getElementById('dropdown-arrow');
            
            dropdown.classList.remove('active');
            arrow.textContent = '‚ñº';
        }

        function selectAccountFromDropdown(accountId) {
            const account = TEST_ACCOUNTS.find(acc => acc.id === accountId);
            if (account) {
                selectAccount(account);
                updateCurrentAccountDisplay();
                populateAccountDropdown(); // Refresh to show new selection
                closeAccountDropdown();
                
                // Show status message
                showStatusMessage(`Now controlling ${account.name} (${account.balance} BB)`, 'info');
            }
        }

        function loadSectionData(section) {
            switch(section) {
                case 'accounts':
                    loadAccountsData();
                    break;
                case 'marketplace':
                    loadMarketsData();
                    break;
                case 'objectwire':
                    loadObjectWireData();
                    break;
                case 'tech-events':
                    loadTechEventsData();
                    break;
                case 'admin':
                    loadSystemStats();
                    break;
            }
        }

        function showStatusMessage(message, type = 'info') {
            const statusDiv = document.getElementById('status-messages');
            const messageEl = document.createElement('div');
            messageEl.className = `status-message ${type}`;
            messageEl.style.cssText = `
                background: ${type === 'success' ? '#27ae60' : type === 'error' ? '#e74c3c' : '#3498db'};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                margin-bottom: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                animation: slideIn 0.3s ease;
            `;
            messageEl.textContent = message;
            
            statusDiv.appendChild(messageEl);
            
            // Remove after 4 seconds
            setTimeout(() => {
                messageEl.remove();
            }, 4000);
        }

        // Test accounts with predefined addresses and names - matching backend accounts
        const TEST_ACCOUNTS = [
            { id: 1, name: 'alice', address: '0x1111111111111111111111111111111111111111', balance: 0, color: '#e74c3c' },
            { id: 2, name: 'bob', address: '0x2222222222222222222222222222222222222222', balance: 0, color: '#3498db' },
            { id: 3, name: 'charlie', address: '0x3333333333333333333333333333333333333333', balance: 0, color: '#2ecc71' },
            { id: 4, name: 'diana', address: '0x4444444444444444444444444444444444444444', balance: 0, color: '#f39c12' },
            { id: 5, name: 'eve', address: '0x5555555555555555555555555555555555555555', balance: 0, color: '#9b59b6' },
            { id: 6, name: 'frank', address: '0x6666666666666666666666666666666666666666', balance: 0, color: '#1abc9c' },
            { id: 7, name: 'grace', address: '0x7777777777777777777777777777777777777777', balance: 0, color: '#34495e' },
            { id: 8, name: 'henry', address: '0x8888888888888888888888888888888888888888', balance: 0, color: '#e67e22' }
        ];

        let currentAccount = TEST_ACCOUNTS[0];
        let markets = [];

        // Sample tech markets
        const SAMPLE_MARKETS = [
            {
                title: "Will NVIDIA stock hit $200 by end of 2025?",
                description: "Prediction on NVIDIA stock reaching $200 per share by December 31, 2025",
                category: "stock_movement",
                outcomes: ["Yes - Hits $200", "No - Stays Below $200"],
                closes_at: "2025-12-31T23:59:59Z",
                initial_liquidity: 5000
            },
            {
                title: "Apple releases Vision Pro 2 in 2025?",
                description: "Will Apple announce and release the Vision Pro 2 during 2025?",
                category: "product_launch", 
                outcomes: ["Yes - Released in 2025", "No - Not in 2025"],
                closes_at: "2025-12-31T23:59:59Z",
                initial_liquidity: 3000
            },
            {
                title: "Tesla achieves full self-driving by Q3 2025?",
                description: "Will Tesla achieve level 5 autonomous driving by September 2025?",
                category: "ai_milestone",
                outcomes: ["Yes - FSD Achieved", "No - Still in Development"],
                closes_at: "2025-09-30T23:59:59Z",
                initial_liquidity: 7000
            },
            {
                title: "Bitcoin crosses $150,000 in 2025?",
                description: "Will Bitcoin reach $150,000 USD at any point during 2025?",
                category: "crypto",
                outcomes: ["Yes - Crosses $150k", "No - Stays Below"],
                closes_at: "2025-12-31T23:59:59Z",
                initial_liquidity: 10000
            },
            {
                title: "OpenAI releases GPT-5 before July 2025?",
                description: "Will OpenAI announce and release GPT-5 before July 1, 2025?",
                category: "ai_milestone",
                outcomes: ["Yes - Released by July", "No - Later or Never"],
                closes_at: "2025-07-01T23:59:59Z",
                initial_liquidity: 4000
            },
            {
                title: "Microsoft acquires another major gaming company?",
                description: "Will Microsoft announce acquisition of a major gaming company (>$1B) in 2025?",
                category: "acquisition",
                outcomes: ["Yes - Major Acquisition", "No - No Major Deal"],
                closes_at: "2025-12-31T23:59:59Z",
                initial_liquidity: 6000
            }
        ];

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initNavigation();
            initializeAccounts();
            renderAccounts();
            loadMarkets();
            populateAccountSelects();
            loadAccountsData(); // Load initial section
        });

        // Initialize accounts with random but fixed token distribution
        function initializeAccounts() {
            const baseAmount = Math.floor(TOTAL_BB_TOKENS / 8);
            const remainder = TOTAL_BB_TOKENS % 8;
            
            TEST_ACCOUNTS.forEach((account, index) => {
                account.balance = baseAmount + (index < remainder ? 1 : 0);
                // Add some random variation for realistic testing
                const variation = Math.floor(Math.random() * 500) - 250;
                account.balance = Math.max(100, account.balance + variation);
            });
            
            // Give whale trader extra tokens
            TEST_ACCOUNTS[7].balance += 2000;
        }

        // Render accounts list
        function renderAccounts() {
            const accountsList = document.getElementById('accounts-list');
            accountsList.innerHTML = '';

            TEST_ACCOUNTS.forEach(account => {
                const accountCard = document.createElement('div');
                accountCard.className = `account-card ${account.id === currentAccount.id ? 'active' : ''}`;
                accountCard.onclick = () => selectAccount(account);
                
                accountCard.innerHTML = `
                    <div class="account-info">
                        <div>
                            <div class="account-name">${account.name}</div>
                            <small>${account.address.slice(0, 10)}...</small>
                        </div>
                        <div class="account-balance">${account.balance.toLocaleString()} BB</div>
                    </div>
                `;
                
                accountsList.appendChild(accountCard);
            });
        }

        // Select an account
        function selectAccount(account) {
            currentAccount = account;
            renderAccounts();
        }

        // Section Data Loading Functions
        function loadAccountsData() {
            renderAccounts();
            updateAccountStats();
            populateAccountSelects();
        }

        function loadMarketsData() {
            loadMarkets();
            populateAccountSelects();
            setupMarketCategories();
        }

        function loadObjectWireData() {
            loadObjectWireMarkets();
            updateObjectWireStatus();
        }

        function loadTechEventsData() {
            loadTechEventsMarkets();
            updateCryptoPrices();
            // Set up crypto price updates every 30 seconds
            setInterval(updateCryptoPrices, 30000);
        }

        // Add the missing loadTechEventsMarkets function
        async function loadTechEventsMarkets() {
            updateCryptoPrices();
        }

        function loadSystemStats() {
            updateSystemStats();
        }

        // Account Management Functions
        function populateAccountSelects() {
            const selects = ['transfer-from', 'transfer-to', 'balance-account'];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Select account...</option>';
                    TEST_ACCOUNTS.forEach(account => {
                        select.innerHTML += `<option value="${account.name.toLowerCase().replace(' ', '')}">${account.name} (${account.balance} BB)</option>`;
                    });
                }
            });
        }

        function updateAccountStats() {
            const statsDiv = document.getElementById('account-stats');
            const totalBalance = TEST_ACCOUNTS.reduce((sum, acc) => sum + acc.balance, 0);
            const avgBalance = Math.round(totalBalance / TEST_ACCOUNTS.length);
            const richestAccount = TEST_ACCOUNTS.reduce((prev, curr) => prev.balance > curr.balance ? prev : curr);
            
            if (statsDiv) {
                statsDiv.innerHTML = `
                    <div style="padding: 15px; background: #f8f9ff; border-radius: 8px; margin-bottom: 10px;">
                        <h4>üí∞ Total Supply</h4>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #667eea;">${totalBalance.toLocaleString()} BB</div>
                    </div>
                    <div style="padding: 15px; background: #f8f9ff; border-radius: 8px; margin-bottom: 10px;">
                        <h4>üìä Average Balance</h4>
                        <div style="font-size: 1.2rem; color: #27ae60;">${avgBalance.toLocaleString()} BB</div>
                    </div>
                    <div style="padding: 15px; background: #f8f9ff; border-radius: 8px;">
                        <h4>üëë Richest Account</h4>
                        <div style="color: #f39c12;">${richestAccount.name}: ${richestAccount.balance.toLocaleString()} BB</div>
                    </div>
                `;
            }
        }

        // Transfer and Balance Functions
        async function transferTokens() {
            const fromAccount = document.getElementById('transfer-from').value;
            const toAccount = document.getElementById('transfer-to').value;
            const amount = parseInt(document.getElementById('transfer-amount').value);

            if (!fromAccount || !toAccount || !amount) {
                showStatusMessage('Please fill in all transfer fields', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/transfer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        from: fromAccount,
                        to: toAccount,
                        amount: amount
                    })
                });

                const result = await response.text();
                showStatusMessage(result, 'success');
                
                // Update balances
                await loadAccountBalances();
                loadAccountsData();
            } catch (error) {
                showStatusMessage('Transfer failed: ' + error.message, 'error');
            }
        }

        async function addBalance() {
            const account = document.getElementById('balance-account').value;
            const amount = parseInt(document.getElementById('balance-amount').value);

            if (!account || !amount) {
                showStatusMessage('Please fill in all balance fields', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/add-balance`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        account: account,
                        amount: amount
                    })
                });

                const result = await response.text();
                showStatusMessage(result, 'success');
                
                // Update balances
                await loadAccountBalances();
                loadAccountsData();
            } catch (error) {
                showStatusMessage('Add balance failed: ' + error.message, 'error');
            }
        }

        // Market Category Functions
        function setupMarketCategories() {
            const categoryItems = document.querySelectorAll('.category-item');
            
            categoryItems.forEach(item => {
                item.addEventListener('click', () => {
                    categoryItems.forEach(cat => cat.classList.remove('active'));
                    item.classList.add('active');
                    
                    const category = item.getAttribute('data-category');
                    filterMarkets(category);
                });
            });
        }

        function filterMarkets(category) {
            // This will filter markets by category
            if (category === 'all') {
                renderMarkets();
            } else {
                const filteredMarkets = markets.filter(market => {
                    if (category === 'live' && market.id.includes('solana')) return true;
                    if (category === 'objectwire' && market.id.includes('ow_')) return true;
                    if (category === 'tech' && (market.id.includes('samsung') || market.id.includes('apple') || market.id.includes('ai'))) return true;
                    if (category === 'policy' && (market.id.includes('fed') || market.id.includes('regulation'))) return true;
                    if (category === 'economics' && (market.id.includes('recession') || market.id.includes('bitcoin'))) return true;
                    if (category === 'corporate' && (market.id.includes('openai') || market.id.includes('tesla'))) return true;
                    if (category === 'geopolitical' && (market.id.includes('ukraine') || market.id.includes('china'))) return true;
                    return false;
                });
                renderFilteredMarkets(filteredMarkets);
            }
        }

        function renderFilteredMarkets(filteredMarkets) {
            const marketsList = document.getElementById('markets-list');
            
            if (!marketsList) return;
            
            const existingContent = marketsList.querySelector('h3').parentNode;
            const marketContainer = marketsList.querySelector('#markets-container') || marketsList;
            
            if (filteredMarkets.length === 0) {
                marketContainer.innerHTML = existingContent.innerHTML + `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <h3>No Markets in This Category</h3>
                        <p>Try selecting a different category</p>
                    </div>
                `;
                return;
            }

            let marketsHTML = '';
            filteredMarkets.forEach(market => {
                marketsHTML += createMarketCard(market);
            });

            marketContainer.innerHTML = existingContent.innerHTML + marketsHTML;
        }

        // ObjectWire Functions
        async function syncObjectWire() {
            try {
                showStatusMessage('Syncing ObjectWire articles...', 'info');
                
                const response = await fetch(`${API_BASE}/objectwire/sync`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                showStatusMessage(`ObjectWire sync complete! Created ${result.new_markets_created} new markets`, 'success');
                
                loadObjectWireData();
            } catch (error) {
                showStatusMessage('ObjectWire sync failed: ' + error.message, 'error');
            }
        }

        async function loadObjectWireMarkets() {
            try {
                const response = await fetch(`${API_BASE}/objectwire/markets`);
                const data = await response.json();
                
                const marketsDiv = document.getElementById('objectwire-markets');
                if (marketsDiv && data.objectwire_markets) {
                    let html = '';
                    data.objectwire_markets.forEach(market => {
                        html += createMarketCard(market);
                    });
                    marketsDiv.innerHTML = html || '<p>No ObjectWire markets available. Click "Sync ObjectWire Articles" to generate markets from latest intelligence.</p>';
                }
            } catch (error) {
                console.error('Error loading ObjectWire markets:', error);
            }
        }

        async function updateObjectWireStatus() {
            try {
                const response = await fetch(`${API_BASE}/objectwire/claims`);
                const data = await response.json();
                
                const statusDiv = document.getElementById('objectwire-status');
                if (statusDiv && data.claims) {
                    statusDiv.innerHTML = `
                        <div style="padding: 15px; background: #f8f9ff; border-radius: 8px; margin-bottom: 10px;">
                            <h4>üìä Total Claims</h4>
                            <div style="font-size: 1.5rem; font-weight: bold; color: #667eea;">${data.total_claims}</div>
                        </div>
                        <div style="padding: 15px; background: #f8f9ff; border-radius: 8px;">
                            <h4>üéØ High Confidence</h4>
                            <div style="color: #27ae60;">${data.claims.filter(c => c.confidence_score > 0.7).length} claims > 70%</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error updating ObjectWire status:', error);
            }
        }

        // System Stats Functions
        async function updateSystemStats() {
            try {
                const [accountsResponse, marketsResponse] = await Promise.all([
                    fetch(`${API_BASE}/accounts`),
                    fetch(`${API_BASE}/markets`)
                ]);

                const accountsData = await accountsResponse.json();
                const marketsData = await marketsResponse.json();

                const statsDiv = document.getElementById('system-stats');
                if (statsDiv) {
                    const totalAccounts = accountsData.total_accounts || TEST_ACCOUNTS.length;
                    const totalMarkets = Array.isArray(marketsData) ? marketsData.length : (marketsData.markets ? marketsData.markets.length : 0);
                    
                    statsDiv.innerHTML = `
                        <div style="padding: 15px; background: #f8f9ff; border-radius: 8px; margin-bottom: 10px;">
                            <h4>üë• Total Accounts</h4>
                            <div style="font-size: 1.5rem; font-weight: bold; color: #667eea;">${totalAccounts}</div>
                        </div>
                        <div style="padding: 15px; background: #f8f9ff; border-radius: 8px; margin-bottom: 10px;">
                            <h4>üìä Active Markets</h4>
                            <div style="font-size: 1.2rem; color: #27ae60;">${totalMarkets}</div>
                        </div>
                        <div style="padding: 15px; background: #f8f9ff; border-radius: 8px;">
                            <h4>üöÄ System Status</h4>
                            <div style="color: #27ae60;">‚úÖ Online & Operational</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error updating system stats:', error);
                const statsDiv = document.getElementById('system-stats');
                if (statsDiv) {
                    statsDiv.innerHTML = `
                        <div style="padding: 15px; background: #ffe6e6; border-radius: 8px;">
                            <h4>‚ö†Ô∏è System Status</h4>
                            <div style="color: #e74c3c;">API Connection Error</div>
                        </div>
                    `;
                }
            }
        }

        // Helper function to create market cards
        function createMarketCard(market) {
            return `
                <div class="market-card">
                    <div class="market-title">${market.title}</div>
                    <div class="market-description">${market.description}</div>
                    <div class="market-stats" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 15px 0; font-size: 0.9em;">
                        <div style="text-align: center; padding: 8px; background: #f8f9ff; border-radius: 6px;">
                            <div style="color: #666;">Volume</div>
                            <div style="font-weight: bold; color: #667eea;">${market.total_volume} BB</div>
                        </div>
                        <div style="text-align: center; padding: 8px; background: #f8f9ff; border-radius: 6px;">
                            <div style="color: #666;">Status</div>
                            <div style="font-weight: bold; color: ${market.is_active ? '#27ae60' : '#e74c3c'};">
                                ${market.is_active ? 'üü¢ Active' : 'üî¥ Closed'}
                            </div>
                        </div>
                        <div style="text-align: center; padding: 8px; background: #f8f9ff; border-radius: 6px;">
                            <div style="color: #666;">Market ID</div>
                            <div style="font-weight: bold; color: #333; font-size: 0.8em;">${market.id}</div>
                        </div>
                    </div>
                    <div class="market-outcomes">
                        ${market.outcomes && market.outcomes.length > 0 ? market.outcomes.map((outcome, index) => `
                            <button class="outcome-button" onclick="placeBetOnMarket('${market.id}', ${index}, '${outcome}')" 
                                    ${!market.is_active ? 'disabled style="opacity: 0.5; cursor: not-allowed;"' : ''}>
                                <span>${outcome}</span>
                                <span class="outcome-odds">${market.odds && market.odds[index] ? market.odds[index].toFixed(2) + 'x' : '2.0x'}</span>
                            </button>
                        `).join('') : '<p style="color: #666; text-align: center;">No betting options available</p>'}
                    </div>
                </div>
            `;
        }

        // Betting function
        async function placeBetOnMarket(marketId, outcomeIndex, outcomeName) {
            if (!currentAccount) {
                showStatusMessage('Please select an account from the header first', 'error');
                return;
            }

            const amount = prompt(`Place bet on "${outcomeName}"\nEnter bet amount (BB tokens):`);
            if (!amount || isNaN(amount) || amount <= 0) {
                showStatusMessage('Invalid bet amount', 'error');
                return;
            }

            try {
                showStatusMessage(`Placing ${amount} BB bet on "${outcomeName}" with ${currentAccount.name}...`, 'info');
                
                const response = await fetch(`${API_BASE}/bet`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        account: currentAccount.name.toLowerCase().replace(' ', ''),
                        market: marketId,
                        outcome: outcomeIndex,
                        amount: parseInt(amount)
                    })
                });

                const result = await response.json();
                
                if (response.ok && result.success) {
                    showStatusMessage(`‚úÖ Bet placed successfully! ${amount} BB on "${outcomeName}"`, 'success');
                    await loadAccountBalances();
                    loadAccountsData();
                    updateCurrentAccountDisplay();
                } else {
                    showStatusMessage(`‚ùå ${result.error || 'Bet placement failed'}`, 'error');
                }
            } catch (error) {
                console.error('Bet placement error:', error);
                showStatusMessage('‚ùå Bet placement failed: ' + error.message, 'error');
            }
        }

        // Load account balances from API
        async function loadAccountBalances() {
            try {
                const response = await fetch(`${API_BASE}/accounts`);
                const data = await response.json();
                
                if (data.accounts) {
                    data.accounts.forEach(apiAccount => {
                        const localAccount = TEST_ACCOUNTS.find(acc => 
                            acc.name.toLowerCase().replace(' ', '') === apiAccount.name ||
                            acc.address === apiAccount.address
                        );
                        if (localAccount) {
                            localAccount.balance = apiAccount.balance;
                        }
                    });
                    
                    // Update current account display if it changed
                    updateCurrentAccountDisplay();
                    populateAccountDropdown();
                }
            } catch (error) {
                console.error('Error loading account balances:', error);
            }
        }

        // Load markets from API
        async function loadMarkets() {
            try {
                console.log('Loading markets from API...');
                const response = await fetch(`${API_BASE}/markets`);
                const data = await response.json();
                console.log('API Response:', data);
                
                // Handle the API response format
                if (data.markets && Array.isArray(data.markets)) {
                    markets = data.markets;
                } else if (Array.isArray(data)) {
                    markets = data;
                } else {
                    markets = [];
                }
                
                console.log('Loaded markets:', markets.length);
                renderMarkets();
            } catch (error) {
                console.error('Error loading markets:', error);
                markets = [];
                renderMarkets();
            }
        }

        // Render markets (updated for new API format)
        function renderMarkets() {
            const marketsList = document.getElementById('markets-list');
            if (!marketsList) return;
            
            if (markets.length === 0) {
                marketsList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <h3>No Markets Available</h3>
                        <p>Markets will be loaded from the API automatically</p>
                    </div>
                `;
                return;
            }

            let marketsHTML = '';
            
            markets.forEach(market => {
                marketsHTML += createMarketCard(market);
            });
            
            marketsList.innerHTML = marketsHTML;
        }

        // Select outcome and calculate potential payout
        function selectOutcome(marketId, outcomeId, outcomeName) {
            const market = markets.find(m => m.id === marketId);
            const outcome = market.outcomes.find(o => o.id === outcomeId);
            const betAmountInput = document.getElementById(`bet-amount-${marketId}`);
            const betOutcomeSelect = document.getElementById(`bet-outcome-${marketId}`);
            const betPreview = document.getElementById(`bet-preview-${marketId}`);
            
            betOutcomeSelect.value = outcomeId;
            
            if (betAmountInput.value) {
                const amount = parseFloat(betAmountInput.value);
                const payout = amount * (1 / outcome.probability);
                const profit = payout - amount;
                
                betPreview.innerHTML = `
                    <div style="background: #f0f8ff; padding: 10px; border-radius: 6px; margin-top: 10px;">
                        <strong>Bet Preview:</strong> ${amount} BB on "${outcomeName}"<br>
                        <strong>Potential Payout:</strong> ${payout.toFixed(2)} BB<br>
                        <strong>Potential Profit:</strong> <span style="color: #27ae60">${profit.toFixed(2)} BB</span>
                    </div>
                `;
            }
        }

        // Place a bet
        async function placeBet(marketId) {
            const betAmountInput = document.getElementById(`bet-amount-${marketId}`);
            const betOutcomeSelect = document.getElementById(`bet-outcome-${marketId}`);
            const amount = parseFloat(betAmountInput.value);
            const outcomeId = betOutcomeSelect.value;
            
            if (!amount || !outcomeId) {
                showMessage('Please enter amount and select outcome', 'error');
                return;
            }
            
            if (amount > currentAccount.balance) {
                showMessage('Insufficient balance', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/markets/${marketId}/bet`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_address: currentAccount.address,
                        outcome_id: outcomeId,
                        amount: amount
                    })
                });

                if (response.ok) {
                    // Update account balance
                    currentAccount.balance -= amount;
                    renderAccounts();
                    
                    // Clear bet form
                    betAmountInput.value = '';
                    betOutcomeSelect.value = '';
                    document.getElementById(`bet-preview-${marketId}`).innerHTML = '';
                    
                    showMessage(`Bet placed successfully! ${amount} BB on market.`, 'success');
                    
                    // Refresh markets to show updated stats
                    setTimeout(() => loadMarkets(), 1000);
                } else {
                    const error = await response.json();
                    showMessage(`Error placing bet: ${error.error || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                console.error('Error placing bet:', error);
                showMessage('Error placing bet. Please try again.', 'error');
            }
        }

        // Tech Events Functions
        async function fetchTechEvents() {
            try {
                showMessage('Fetching tech events from Google News...', 'info');
                document.getElementById('tech-events-status').innerHTML = 'Status: Fetching events...';
                
                const response = await fetch(`${API_BASE}/tech-events`);
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('tech-events-status').innerHTML = 
                        `Status: Found ${result.events.length} events`;
                    showMessage(`Fetched ${result.events.length} tech events!`, 'success');
                } else {
                    throw new Error(result.error || 'Failed to fetch events');
                }
            } catch (error) {
                console.error('Error fetching tech events:', error);
                document.getElementById('tech-events-status').innerHTML = 'Status: Error fetching events';
                showMessage(`Error: ${error.message}`, 'error');
            }
        }

        async function syncTechEvents() {
            try {
                showMessage('Syncing top 100 tech events to markets...', 'info');
                document.getElementById('tech-events-status').innerHTML = 'Status: Syncing to markets...';
                
                const response = await fetch(`${API_BASE}/sync-tech-events`, {
                    method: 'POST'
                });
                const result = await response.json();
                
                if (response.ok) {
                    document.getElementById('tech-events-status').innerHTML = 
                        `Status: Synced ${result.markets_created} markets`;
                    showMessage(`Created ${result.markets_created} tech event markets!`, 'success');
                    loadTechEventsMarkets();
                } else {
                    throw new Error(result.error || 'Failed to sync events');
                }
            } catch (error) {
                console.error('Error syncing tech events:', error);
                document.getElementById('tech-events-status').innerHTML = 'Status: Error syncing events';
                showMessage(`Error: ${error.message}`, 'error');
            }
        }

        async function loadTechEventsMarkets() {
            try {
                const response = await fetch(`${API_BASE}/markets`);
                const allMarkets = await response.json();
                
                // Filter tech events markets
                const techMarkets = allMarkets.filter(m => 
                    m.category === 'tech' || m.category === 'crypto' || 
                    m.category === 'business' || m.title.includes('BTC') || m.title.includes('SOL'));
                
                const marketsList = document.getElementById('tech-events-markets');
                if (techMarkets.length === 0) {
                    marketsList.innerHTML = '<p style="color: #888;">No tech events markets available. Sync events to create markets.</p>';
                    return;
                }
                
                marketsList.innerHTML = techMarkets.map(market => `
                    <div class="market-card" style="margin-bottom: 10px; padding: 10px; background: #1e1e1e; border-radius: 5px;">
                        <div style="font-weight: bold; color: #fff; margin-bottom: 5px;">${market.title}</div>
                        <div style="font-size: 0.9em; color: #ccc; margin-bottom: 8px;">${market.description}</div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="color: #4CAF50;">
                                Yes: ${market.yes_odds}% | No: ${100 - market.yes_odds}%
                            </div>
                            <div style="color: #888; font-size: 0.8em;">
                                ${market.category} ‚Ä¢ ID: ${market.id}
                            </div>
                        </div>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('Error loading tech events markets:', error);
                document.getElementById('tech-events-markets').innerHTML = 
                    '<p style="color: #f44336;">Error loading markets</p>';
            }
        }

        async function placeCryptoBet(crypto, direction) {
            if (!currentAccount) {
                showStatusMessage('Please select an account from the header first', 'error');
                return;
            }
            
            try {
                const amount = 10; // Fixed bet amount for crypto
                const response = await fetch(`${API_BASE}/crypto-bet`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        account: currentAccount.name.toLowerCase().replace(' ', ''),
                        crypto: crypto,
                        direction: direction,
                        amount: amount
                    })
                });
                
                const result = await response.json();
                if (response.ok) {
                    showStatusMessage(`${crypto} ${direction} bet placed! Amount: ${amount} BB by ${currentAccount.name}`, 'success');
                    updateCryptoPrices();
                } else {
                    showStatusMessage(`Error: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Error placing crypto bet:', error);
                showStatusMessage('Error placing crypto bet', 'error');
            }
        }

        async function updateCryptoPrices() {
            try {
                const response = await fetch(`${API_BASE}/crypto-prices`);
                const prices = await response.json();
                
                if (response.ok) {
                    document.getElementById('btc-price').textContent = 
                        `$${prices.btc_price.toLocaleString()}`;
                    document.getElementById('sol-price').textContent = 
                        `$${prices.sol_price.toFixed(2)}`;
                    
                    // Update countdown
                    const nextResolution = new Date(prices.next_resolution);
                    const now = new Date();
                    const diff = nextResolution - now;
                    
                    if (diff > 0) {
                        const minutes = Math.floor(diff / 60000);
                        const seconds = Math.floor((diff % 60000) / 1000);
                        document.getElementById('crypto-bets-status').innerHTML = 
                            `Next resolution in: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                    } else {
                        document.getElementById('crypto-bets-status').innerHTML = 
                            'Next resolution in: 00:00 (resolving...)';
                    }
                }
            } catch (error) {
                console.error('Error updating crypto prices:', error);
            }
        }

        // Admin functions
        async function createSampleMarkets() {
            showMessage('Creating sample markets...', 'success');
            
            for (const sampleMarket of SAMPLE_MARKETS) {
                try {
                    const response = await fetch(`${API_BASE}/markets`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            ...sampleMarket,
                            creator: currentAccount.address
                        })
                    });
                    
                    if (response.ok) {
                        console.log(`Created market: ${sampleMarket.title}`);
                    } else {
                        console.error(`Failed to create market: ${sampleMarket.title}`);
                    }
                } catch (error) {
                    console.error('Error creating market:', error);
                }
                
                // Small delay between requests
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            showMessage('Sample markets created!', 'success');
            setTimeout(() => loadMarkets(), 2000);
        }

        function distributeTokens() {
            initializeAccounts();
            renderAccounts();
            showMessage('BlackBook tokens redistributed!', 'success');
        }

        function resetAllBalances() {
            TEST_ACCOUNTS.forEach(account => {
                account.balance = Math.floor(TOTAL_BB_TOKENS / 8);
            });
            renderAccounts();
            showMessage('All balances reset!', 'success');
        }

        function exportTestData() {
            const data = {
                accounts: TEST_ACCOUNTS,
                markets: markets,
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'blackbook-test-data.json';
            a.click();
            URL.revokeObjectURL(url);
            
            showMessage('Test data exported!', 'success');
        }

        function resolveAllMarkets() {
            showMessage('Market resolution feature coming soon!', 'success');
        }

        function refreshData() {
            loadMarkets();
            showMessage('Data refreshed!', 'success');
        }

        // Utility functions
        function showMessage(message, type) {
            // Remove existing messages
            const existingMessages = document.querySelectorAll('.success-message, .error-message');
            existingMessages.forEach(msg => msg.remove());
            
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
            messageDiv.textContent = message;
            
            document.querySelector('.container').appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }

        // Update bet previews when amount changes
        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('bet-input') && e.target.type === 'number') {
                const marketId = e.target.id.replace('bet-amount-', '');
                const outcomeSelect = document.getElementById(`bet-outcome-${marketId}`);
                
                if (outcomeSelect.value) {
                    const market = markets.find(m => m.id === marketId);
                    const outcome = market.outcomes.find(o => o.id === outcomeSelect.value);
                    const amount = parseFloat(e.target.value) || 0;
                    const betPreview = document.getElementById(`bet-preview-${marketId}`);
                    
                    if (amount > 0) {
                        const payout = amount * (1 / outcome.probability);
                        const profit = payout - amount;
                        
                        betPreview.innerHTML = `
                            <div style="background: #f0f8ff; padding: 10px; border-radius: 6px; margin-top: 10px;">
                                <strong>Bet Preview:</strong> ${amount} BB on "${outcome.name}"<br>
                                <strong>Potential Payout:</strong> ${payout.toFixed(2)} BB<br>
                                <strong>Potential Profit:</strong> <span style="color: #27ae60">${profit.toFixed(2)} BB</span>
                            </div>
                        `;
                    } else {
                        betPreview.innerHTML = '';
                    }
                }
            }
        });
    </script>
</body>
</html>