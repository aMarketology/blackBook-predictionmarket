<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlackBook - The DraftKings of Tech & Politics</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f0f2f5;
            color: #1c1e21;
            line-height: 1.34;
        }

        /* Navigation Header */
        .navbar {
            background: #fff;
            border-bottom: 1px solid #dadde1;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 60px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #1877f2;
            text-decoration: none;
        }

        .nav-tabs {
            display: flex;
            gap: 0;
        }

        .nav-tab {
            padding: 18px 20px;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            color: #65676b;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .nav-tab.active {
            color: #1877f2;
            border-bottom-color: #1877f2;
        }

        .nav-tab:hover {
            background: #f2f3f5;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .balance-display {
            background: #e7f3ff;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            color: #1877f2;
        }

        .admin-button {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .admin-button:hover {
            background: #ee5a52;
            transform: scale(1.05);
        }

        /* Admin Modal */
        .admin-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .admin-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .admin-panel {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 15px;
        }

        .admin-header h2 {
            color: #1877f2;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #000;
        }

        .admin-accounts {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .account-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .account-card h3 {
            color: #1877f2;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .account-info {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .account-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .account-actions input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }

        .account-actions button {
            padding: 8px 12px;
            background: #1877f2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }

        .account-actions button:hover {
            background: #165ec7;
        }

        /* Main Content */
        .main-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
        }

        /* Left Sidebar */
        .left-sidebar {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            height: fit-content;
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }

        .account-selector {
            margin-bottom: 20px;
        }

        .account-selector h3 {
            font-size: 16px;
            margin-bottom: 10px;
            color: #1c1e21;
        }

        .account-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .account-btn {
            padding: 10px 12px;
            border: 2px solid #e4e6ea;
            border-radius: 6px;
            background: #fff;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            text-align: center;
        }

        .account-btn:hover {
            border-color: #1877f2;
        }

        .account-btn.active {
            border-color: #1877f2;
            background: #e7f3ff;
            color: #1877f2;
        }

        .crypto-prices {
            margin-top: 20px;
        }

        .crypto-prices h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #1c1e21;
        }

        .crypto-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #f7f8fa;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .crypto-name {
            font-weight: 600;
            font-size: 14px;
        }

        .crypto-price {
            font-size: 14px;
            font-weight: 600;
        }

        .price-up { color: #42b883; }
        .price-down { color: #e74c3c; }

        /* Center Content */
        .center-content {
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }

        .content-header {
            padding: 20px;
            border-bottom: 1px solid #e4e6ea;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .content-header h2 {
            font-size: 20px;
            font-weight: 600;
        }

        .search-bar {
            flex: 1;
            max-width: 300px;
            margin: 0 20px;
        }

        .search-input {
            width: 100%;
            padding: 8px 16px;
            border: 1px solid #ccd0d5;
            border-radius: 20px;
            background: #f0f2f5;
            font-size: 15px;
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
        }

        .filter-btn {
            padding: 6px 12px;
            border: 1px solid #ccd0d5;
            border-radius: 6px;
            background: #f0f2f5;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .filter-btn.active {
            background: #1877f2;
            color: #fff;
            border-color: #1877f2;
        }

        /* Markets Grid - 3x3 Layout */
        .markets-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 20px;
            padding: 20px;
            min-height: 600px;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            gap: 10px;
        }

        .pagination button {
            padding: 8px 16px;
            border: 1px solid #ccd0d5;
            border-radius: 6px;
            background: #fff;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        .pagination button:hover {
            background: #f0f2f5;
        }

        .pagination button.active {
            background: #1877f2;
            color: #fff;
            border-color: #1877f2;
        }

        .pagination button:disabled {
            background: #f0f2f5;
            color: #ccd0d5;
            cursor: not-allowed;
        }

        .market-card {
            border: 1px solid #e4e6ea;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.2s;
            background: #fff;
        }

        .market-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,.12);
            transform: translateY(-2px);
        }

        .market-header {
            padding: 16px;
            background: #f7f8fa;
            border-bottom: 1px solid #e4e6ea;
        }

        .market-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
            color: #1c1e21;
        }

        .market-category {
            font-size: 12px;
            color: #65676b;
            text-transform: uppercase;
            font-weight: 600;
        }

        .market-body {
            padding: 16px;
        }

        .market-description {
            font-size: 14px;
            color: #65676b;
            margin-bottom: 16px;
            line-height: 1.4;
        }

        .betting-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 16px;
        }

        .outcome-btn {
            padding: 12px;
            border: 2px solid #e4e6ea;
            border-radius: 6px;
            background: #fff;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            text-align: center;
        }

        .outcome-btn:hover {
            border-color: #1877f2;
            background: #f0f8ff;
        }

        .outcome-btn.selected {
            border-color: #1877f2;
            background: #1877f2;
            color: #fff;
        }

        .bet-controls {
            display: flex;
            gap: 8px;
        }

        .bet-amount-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ccd0d5;
            border-radius: 6px;
            font-size: 14px;
        }

        .place-bet-btn {
            padding: 8px 16px;
            background: #42b883;
            color: #fff;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .place-bet-btn:hover {
            background: #369870;
        }

        .place-bet-btn:disabled {
            background: #ccd0d5;
            cursor: not-allowed;
        }

        /* Right Sidebar */
        .right-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .sidebar-widget {
            background: #fff;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,.1);
        }

        .widget-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f2f5;
        }

        .leaderboard-item:last-child {
            border-bottom: none;
        }

        /* Receipts Tab */
        .receipts-container {
            max-height: 500px;
            overflow-y: auto;
        }

        .receipt-item {
            padding: 12px;
            border-bottom: 1px solid #e4e6ea;
            font-size: 14px;
        }

        .receipt-item:last-child {
            border-bottom: none;
        }

        .receipt-time {
            color: #65676b;
            font-size: 12px;
        }

        .receipt-action {
            font-weight: 600;
            margin-top: 4px;
        }

        .receipt-win { color: #42b883; }
        .receipt-lose { color: #e74c3c; }
        .receipt-bet { color: #1877f2; }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 250px 1fr;
                gap: 15px;
            }
            .right-sidebar {
                display: none;
            }
            .markets-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            .left-sidebar {
                order: 2;
            }
            .markets-grid {
                grid-template-columns: 1fr;
                min-height: auto;
            }
            .nav-tabs {
                flex-wrap: wrap;
                justify-content: center;
            }
            .nav-tab {
                padding: 12px 16px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .nav-container {
                flex-direction: column;
                height: auto;
                padding: 10px;
                gap: 10px;
            }
            .nav-tabs {
                order: 2;
            }
            .user-info {
                order: 3;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1877f2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Notification Toast */
        .toast {
            position: fixed;
            top: 80px;
            right: 20px;
            padding: 16px 20px;
            background: #42b883;
            color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: #e74c3c;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="#" class="logo">
                <i class="fas fa-chart-line"></i> BlackBook
            </a>
            
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('all')">
                    <i class="fas fa-store"></i> All Markets
                </button>
                <button class="nav-tab" onclick="showTab('crypto')">
                    <i class="fab fa-bitcoin"></i> Crypto
                </button>
                <button class="nav-tab" onclick="showTab('politics')">
                    <i class="fas fa-landmark"></i> Politics
                </button>
                <button class="nav-tab" onclick="showTab('business')">
                    <i class="fas fa-briefcase"></i> Business
                </button>
                <button class="nav-tab" onclick="showTab('tech')">
                    <i class="fas fa-microchip"></i> Tech
                </button>
                <button class="nav-tab" onclick="showTab('recipes')">
                    <i class="fas fa-list"></i> Recipes
                </button>
            </div>

            <div class="user-info">
                <button class="admin-button" onclick="openAdminPanel()">
                    <i class="fas fa-cog"></i> Admin
                </button>
                <div class="balance-display">
                    <i class="fas fa-coins"></i> <span id="userBalance">Loading...</span> BB
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Left Sidebar -->
        <div class="left-sidebar">
            <div class="account-selector">
                <h3><i class="fas fa-user"></i> Select Account</h3>
                <div class="account-grid" id="accountGrid">
                    <!-- Accounts loaded dynamically -->
                </div>
            </div>

            <div class="crypto-prices">
                <h3><i class="fas fa-chart-line"></i> Live Prices</h3>
                <div class="crypto-item">
                    <div class="crypto-name">Bitcoin</div>
                    <div class="crypto-price" id="btcPrice">Loading...</div>
                </div>
                <div class="crypto-item">
                    <div class="crypto-name">Solana</div>
                    <div class="crypto-price" id="solPrice">Loading...</div>
                </div>
            </div>
        </div>

        <!-- Center Content -->
        <div class="center-content">
            <!-- All Markets Tab -->
            <div id="allTab" class="tab-content active">
                <div class="content-header">
                    <h2>All Prediction Markets</h2>
                    <div class="search-bar">
                        <input type="text" class="search-input" placeholder="Search all markets..." id="searchInput">
                    </div>
                </div>
                
                <div class="markets-grid" id="allMarketsGrid">
                    <!-- All markets loaded dynamically -->
                </div>
                
                <div class="pagination" id="allMarketsPagination">
                    <!-- Pagination loaded dynamically -->
                </div>
            </div>

            <!-- Crypto Tab -->
            <div id="cryptoTab" class="tab-content">
                <div class="content-header">
                    <h2>Crypto Predictions</h2>
                    <div class="filter-buttons">
                        <button class="filter-btn active" onclick="filterCrypto('5min')">5 Min</button>
                        <button class="filter-btn" onclick="filterCrypto('15min')">15 Min</button>
                        <button class="filter-btn" onclick="filterCrypto('1hour')">1 Hour</button>
                    </div>
                </div>
                
                <div class="markets-grid" id="cryptoMarketsGrid">
                    <!-- Crypto markets loaded dynamically -->
                </div>
            </div>

            <!-- Politics Tab -->
            <div id="politicsTab" class="tab-content">
                <div class="content-header">
                    <h2>Political Predictions</h2>
                    <div class="search-bar">
                        <input type="text" class="search-input" placeholder="Search political markets..." id="politicsSearchInput">
                    </div>
                </div>
                
                <div class="markets-grid" id="politicsMarketsGrid">
                    <!-- Politics markets loaded dynamically -->
                </div>
            </div>

            <!-- Business Tab -->
            <div id="businessTab" class="tab-content">
                <div class="content-header">
                    <h2>Business Predictions</h2>
                    <div class="search-bar">
                        <input type="text" class="search-input" placeholder="Search business markets..." id="businessSearchInput">
                    </div>
                </div>
                
                <div class="markets-grid" id="businessMarketsGrid">
                    <!-- Business markets loaded dynamically -->
                </div>
            </div>

            <!-- Tech Tab -->
            <div id="techTab" class="tab-content">
                <div class="content-header">
                    <h2>Tech Predictions</h2>
                    <div class="search-bar">
                        <input type="text" class="search-input" placeholder="Search tech markets..." id="techSearchInput">
                    </div>
                </div>
                
                <div class="markets-grid" id="techMarketsGrid">
                    <!-- Tech markets loaded dynamically -->
                </div>
            </div>

            <!-- Recipes Tab -->
            <div id="recipesTab" class="tab-content">
                <div class="content-header">
                    <h2>Platform Activity Recipes</h2>
                    <div class="filter-buttons">
                        <button class="filter-btn active" onclick="filterRecipes('all')">All Activity</button>
                        <button class="filter-btn" onclick="filterRecipes('bets')">Bets Placed</button>
                        <button class="filter-btn" onclick="filterRecipes('wins')">Wins</button>
                        <button class="filter-btn" onclick="filterRecipes('losses')">Losses</button>
                    </div>
                </div>
                
                <div class="receipts-container" id="recipesContainer">
                    <!-- Platform activity recipes loaded dynamically -->
                </div>
            </div>
        </div>

        <!-- Right Sidebar - REMOVED -->
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <span id="toastMessage"></span>
    </div>

    <!-- Admin Modal -->
    <div id="adminModal" class="admin-modal">
        <div class="admin-panel">
            <div class="admin-header">
                <h2><i class="fas fa-cog"></i> Admin Panel - Account Management</h2>
                <button class="close-btn" onclick="closeAdminPanel()">&times;</button>
            </div>
            
            <div class="admin-accounts" id="adminAccountsList">
                <!-- Admin account cards loaded dynamically -->
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentAccount = null;
        let markets = [];
        let accounts = [];
        let receipts = [];
        let recipes = [];
        let cryptoPrices = {};
        let currentPage = 1;
        let marketsPerPage = 9; // 3x3 grid

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadAccounts();
            loadMarkets();
            loadCryptoPrices();
            loadReceipts();
            loadRecipes();
            
            // Start auto-refresh for crypto prices
            setInterval(loadCryptoPrices, 5 * 60 * 1000); // Every 5 minutes
            
            // Start auto-refresh for receipts and recipes
            setInterval(loadReceipts, 30 * 1000); // Every 30 seconds
            setInterval(loadRecipes, 30 * 1000); // Every 30 seconds
        });

        // Tab management
        function showTab(tabName) {
            // Update nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.closest('.nav-tab').classList.add('active');
            
            // Update content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // Reset pagination for new tabs
            currentPage = 1;
            
            // Load tab-specific data
            switch(tabName) {
                case 'all':
                    renderAllMarkets();
                    break;
                case 'crypto':
                    loadCryptoMarkets();
                    break;
                case 'politics':
                    loadCategoryMarkets('politics');
                    break;
                case 'business':
                    loadCategoryMarkets('business');
                    break;
                case 'tech':
                    loadCategoryMarkets('tech');
                    break;
                case 'recipes':
                    loadRecipes();
                    break;
            }
        }

        // Load real accounts from blockchain
        async function loadAccounts() {
            try {
                const response = await fetch('http://localhost:3000/accounts');
                const data = await response.json();
                accounts = data.accounts;
                
                const accountGrid = document.getElementById('accountGrid');
                accountGrid.innerHTML = accounts.map(account => `
                    <button class="account-btn" onclick="selectAccount('${account.name}')">
                        ${account.name}
                        <div style="font-size: 12px; color: #65676b;">${account.balance} BB</div>
                    </button>
                `).join('');
                
                // Select first account by default
                if (accounts.length > 0) {
                    selectAccount(accounts[0].name);
                }
            } catch (error) {
                showToast('Failed to load real accounts from blockchain', 'error');
                console.error('Account loading error:', error);
            }
        }

        // Select account
        function selectAccount(accountName) {
            currentAccount = accountName;
            
            // Update UI
            document.querySelectorAll('.account-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update balance display
            const account = accounts.find(a => a.name === accountName);
            if (account) {
                document.getElementById('userBalance').textContent = account.balance;
            }
        }

        // Load markets - REAL DATA ONLY
        async function loadMarkets() {
            try {
                const response = await fetch('http://localhost:3000/markets');
                const data = await response.json();
                
                // Only use real blockchain markets - NO dummy data
                markets = data.markets.map(market => ({
                    id: market.id,
                    title: market.title,
                    description: market.description,
                    outcomes: market.outcomes,
                    category: categorizeMarket(market), // Categorize based on content
                    is_active: market.is_active,
                    total_volume: market.total_volume,
                    odds: market.odds
                }));
                
                renderAllMarkets();
                updateMarketStats();
            } catch (error) {
                showToast('Failed to load real markets from blockchain', 'error');
                console.error('Market loading error:', error);
            }
        }

        // Categorize real markets based on their content
        function categorizeMarket(market) {
            const title = market.title.toLowerCase();
            const description = market.description.toLowerCase();
            
            if (title.includes('bitcoin') || title.includes('solana') || title.includes('btc') || 
                title.includes('crypto') || description.includes('cryptocurrency')) {
                return 'crypto';
            }
            if (title.includes('election') || title.includes('nato') || title.includes('congress') || 
                title.includes('ukraine') || description.includes('political')) {
                return 'politics';
            }
            if (title.includes('ipo') || title.includes('fed') || title.includes('recession') || 
                title.includes('opec') || description.includes('economic')) {
                return 'business';
            }
            // Default to tech for AI, quantum, tech company markets
            return 'tech';
        }

        // Render all markets with pagination
        function renderAllMarkets() {
            const startIndex = (currentPage - 1) * marketsPerPage;
            const endIndex = startIndex + marketsPerPage;
            const paginatedMarkets = markets.slice(startIndex, endIndex);
            
            const marketsGrid = document.getElementById('allMarketsGrid');
            marketsGrid.innerHTML = renderMarketCards(paginatedMarkets);
            
            renderPagination();
        }

        // Render market cards
        function renderMarketCards(marketList) {
            return marketList.map(market => `
                <div class="market-card" data-category="${market.category || 'tech'}">
                    <div class="market-header">
                        <div class="market-title">${market.title}</div>
                        <div class="market-category">${(market.category || 'Tech').toUpperCase()}</div>
                    </div>
                    <div class="market-body">
                        <div class="market-description">${market.description}</div>
                        <div class="betting-section">
                            ${market.outcomes.map((outcome, index) => `
                                <button class="outcome-btn" onclick="selectOutcome('${market.id}', ${index})">
                                    ${outcome}
                                </button>
                            `).join('')}
                        </div>
                        <div class="bet-controls">
                            <input type="number" class="bet-amount-input" placeholder="Amount (BB)" min="1" max="1000" id="amount-${market.id}">
                            <button class="place-bet-btn" onclick="placeBet('${market.id}')">
                                <i class="fas fa-bolt"></i> Bet
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Render pagination
        function renderPagination() {
            const totalPages = Math.ceil(markets.length / marketsPerPage);
            const paginationContainer = document.getElementById('allMarketsPagination');
            
            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `<button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                <i class="fas fa-chevron-left"></i> Previous
            </button>`;
            
            // Page numbers
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `<button onclick="changePage(${i})" ${i === currentPage ? 'class="active"' : ''}>
                    ${i}
                </button>`;
            }
            
            // Next button
            paginationHTML += `<button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                Next <i class="fas fa-chevron-right"></i>
            </button>`;
            
            paginationContainer.innerHTML = paginationHTML;
        }

        // Change page
        function changePage(newPage) {
            const totalPages = Math.ceil(markets.length / marketsPerPage);
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                renderAllMarkets();
            }
        }

        // Load category-specific markets
        function loadCategoryMarkets(category) {
            const filteredMarkets = markets.filter(m => (m.category || 'tech') === category);
            const gridId = category + 'MarketsGrid';
            const grid = document.getElementById(gridId);
            
            // For categories, show first 9 without pagination for now
            const displayMarkets = filteredMarkets.slice(0, 9);
            grid.innerHTML = renderMarketCards(displayMarkets);
        }

        // Load crypto prices
        async function loadCryptoPrices() {
            try {
                const btcResponse = await fetch('http://localhost:3000/bitcoin-price');
                const btcData = await btcResponse.json();
                console.log('BTC Data:', btcData);
                
                const solResponse = await fetch('http://localhost:3000/solana-price');
                const solData = await solResponse.json();
                console.log('SOL Data:', solData);
                
                // Update prices with trend indicators
                updateCryptoPrice('btcPrice', btcData.price, cryptoPrices.btc);
                updateCryptoPrice('solPrice', solData.price, cryptoPrices.sol);
                
                cryptoPrices.btc = btcData.price;
                cryptoPrices.sol = solData.price;
                
                console.log('Updated prices - BTC: $' + btcData.price + ', SOL: $' + solData.price);
                
                // Generate crypto prediction markets
                generateCryptoPredictionMarkets();
            } catch (error) {
                console.error('Failed to load crypto prices:', error);
                showToast('Failed to load crypto prices', 'error');
            }
        }

        // Update crypto price display
        function updateCryptoPrice(elementId, newPrice, oldPrice) {
            const element = document.getElementById(elementId);
            const formattedPrice = new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(newPrice);
            
            element.textContent = formattedPrice;
            
            // Add trend class
            if (oldPrice !== undefined) {
                element.className = 'crypto-price ' + (newPrice > oldPrice ? 'price-up' : 'price-down');
            }
        }

        // Generate crypto prediction markets
        function generateCryptoPredictionMarkets() {
            const cryptoMarkets = [
                {
                    id: 'btc_5min_prediction',
                    title: 'Bitcoin Price in 5 Minutes',
                    description: `Current: $${cryptoPrices.btc?.toFixed(2)} - Will it go up or down?`,
                    outcomes: ['📈 Higher', '📉 Lower'],
                    category: 'crypto',
                    timeframe: '5min'
                },
                {
                    id: 'sol_5min_prediction',
                    title: 'Solana Price in 5 Minutes',
                    description: `Current: $${cryptoPrices.sol?.toFixed(2)} - Will it go up or down?`,
                    outcomes: ['📈 Higher', '📉 Lower'],
                    category: 'crypto',
                    timeframe: '5min'
                }
            ];
            
            // Add to markets if not already present
            cryptoMarkets.forEach(newMarket => {
                const existingIndex = markets.findIndex(m => m.id === newMarket.id);
                if (existingIndex >= 0) {
                    markets[existingIndex] = newMarket; // Update existing
                } else {
                    markets.push(newMarket); // Add new
                }
            });
        }

        // Load crypto markets for crypto tab
        function loadCryptoMarkets() {
            const cryptoMarkets = markets.filter(m => m.category === 'crypto');
            const cryptoGrid = document.getElementById('cryptoMarketsGrid');
            
            cryptoGrid.innerHTML = cryptoMarkets.map(market => `
                <div class="market-card">
                    <div class="market-header">
                        <div class="market-title">${market.title}</div>
                        <div class="market-category">Crypto • ${market.timeframe || '5min'}</div>
                    </div>
                    <div class="market-body">
                        <div class="market-description">${market.description}</div>
                        <div class="betting-section">
                            ${market.outcomes.map((outcome, index) => `
                                <button class="outcome-btn" onclick="selectOutcome('${market.id}', ${index})">
                                    ${outcome}
                                </button>
                            `).join('')}
                        </div>
                        <div class="bet-controls">
                            <input type="number" class="bet-amount-input" placeholder="Amount (BB)" min="1" max="1000" id="amount-${market.id}">
                            <button class="place-bet-btn" onclick="placeBet('${market.id}')">
                                <i class="fas fa-bolt"></i> Bet
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Select outcome
        let selectedOutcomes = {};
        function selectOutcome(marketId, outcomeIndex) {
            selectedOutcomes[marketId] = outcomeIndex;
            
            // Update UI
            const card = document.querySelector(`[data-market="${marketId}"], .market-card`);
            card.querySelectorAll('.outcome-btn').forEach((btn, index) => {
                btn.classList.toggle('selected', index === outcomeIndex);
            });
        }

        // Place bet
        async function placeBet(marketId) {
            if (!currentAccount) {
                showToast('Please select an account first', 'error');
                return;
            }
            
            const outcomeIndex = selectedOutcomes[marketId];
            if (outcomeIndex === undefined) {
                showToast('Please select an outcome first', 'error');
                return;
            }
            
            const amountInput = document.getElementById(`amount-${marketId}`);
            const amount = parseInt(amountInput.value);
            
            if (!amount || amount < 1) {
                showToast('Please enter a valid bet amount', 'error');
                return;
            }
            
            try {
                const response = await fetch('http://localhost:3000/bet', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        account: currentAccount,
                        market: marketId,
                        outcome: outcomeIndex,
                        amount: amount
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast(`Bet placed successfully! ${amount} BB on "${result.bet.market}"`, 'success');
                    
                    // Add to receipts
                    addReceipt({
                        type: 'bet',
                        account: currentAccount,
                        market: marketId,
                        outcome: outcomeIndex,
                        amount: amount,
                        timestamp: new Date()
                    });
                    
                    // Clear form
                    amountInput.value = '';
                    delete selectedOutcomes[marketId];
                    
                    // Refresh account balance
                    loadAccounts();
                } else {
                    showToast(result.message || 'Failed to place bet', 'error');
                }
            } catch (error) {
                showToast('Network error. Please try again.', 'error');
            }
        }

        // Load receipts
        async function loadReceipts() {
            // For now, use local storage for receipts
            // In a real app, this would come from the backend
            const storedReceipts = localStorage.getItem('blackbook_receipts');
            if (storedReceipts) {
                receipts = JSON.parse(storedReceipts);
            }
            
            renderReceipts();
        }

        // Load real recipes from blockchain activity - NO DUMMY DATA
        async function loadRecipes() {
            try {
                // Get real bets from blockchain Layer 1
                const response = await fetch('http://localhost:3000/bets');
                const data = await response.json();
                
                // Convert real blockchain bets to recipe format
                recipes = data.bets.map(bet => ({
                    id: bet.id,
                    type: 'bet_placed',
                    user: bet.account,
                    description: `${bet.account} placed ${bet.amount} BB bet on market ${bet.market_id}`,
                    timestamp: new Date(bet.timestamp),
                    amount: bet.amount
                }));
                
                // Also fetch transaction data
                try {
                    const txResponse = await fetch('http://localhost:3000/transactions');
                    const txData = await txResponse.json();
                    
                    // Add transactions as recipes
                    const txRecipes = txData.transactions.map((tx, idx) => ({
                        id: `tx_${idx}`,
                        type: 'transaction',
                        user: 'system',
                        description: `Transaction ${tx.type}: ${tx.status}`,
                        timestamp: new Date(tx.timestamp),
                        amount: 0
                    }));
                    
                    recipes = [...recipes, ...txRecipes];
                } catch (e) {
                    console.log('Could not fetch transactions, using bets only');
                }
                
                // Sort by timestamp (newest first)
                recipes.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                console.log(`Loaded ${recipes.length} real blockchain activities`);
                renderRecipes();
                
            } catch (error) {
                console.error('Failed to load real blockchain bets:', error);
                showToast('Failed to load activity from blockchain', 'error');
                
                // Initialize empty recipes if blockchain unavailable
                recipes = [];
                renderRecipes();
            }
        }

        // Add receipt
        function addReceipt(receipt) {
            receipts.unshift(receipt);
            
            // Also add to recipes for platform tracking
            addRecipe({
                id: `recipe_${Date.now()}`,
                type: receipt.type,
                user: receipt.account,
                description: `${receipt.account} ${receipt.type === 'bet' ? 'placed' : receipt.type} ${receipt.amount} BB ${receipt.type === 'bet' ? 'bet on' : 'from'} "${receipt.market}"`,
                timestamp: receipt.timestamp,
                amount: receipt.amount
            });
            
            // Keep only last 100 receipts
            if (receipts.length > 100) {
                receipts = receipts.slice(0, 100);
            }
            
            // Store in localStorage
            localStorage.setItem('blackbook_receipts', JSON.stringify(receipts));
            
            renderReceipts();
        }

        // Add recipe (platform activity)
        function addRecipe(recipe) {
            recipes.unshift(recipe);
            
            // Keep only last 200 recipes
            if (recipes.length > 200) {
                recipes = recipes.slice(0, 200);
            }
            
            // Store in localStorage
            localStorage.setItem('blackbook_recipes', JSON.stringify(recipes));
            
            renderRecipes();
        }

        // Render receipts
        function renderReceipts() {
            const container = document.getElementById('receiptsContainer');
            
            if (receipts.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #65676b;">No activity yet. Place some bets to see your activity here!</div>';
                return;
            }
            
            container.innerHTML = receipts.map(receipt => {
                const timeAgo = getTimeAgo(new Date(receipt.timestamp));
                const market = markets.find(m => m.id === receipt.market);
                const marketTitle = market ? market.title : receipt.market;
                
                let actionText = '';
                let actionClass = '';
                
                switch (receipt.type) {
                    case 'bet':
                        actionText = `Placed ${receipt.amount} BB bet on "${marketTitle}"`;
                        actionClass = 'receipt-bet';
                        break;
                    case 'win':
                        actionText = `Won ${receipt.amount} BB from "${marketTitle}"`;
                        actionClass = 'receipt-win';
                        break;
                    case 'lose':
                        actionText = `Lost ${receipt.amount} BB on "${marketTitle}"`;
                        actionClass = 'receipt-lose';
                        break;
                }
                
                return `
                    <div class="receipt-item">
                        <div class="receipt-time">${timeAgo}</div>
                        <div class="receipt-action ${actionClass}">
                            <i class="fas ${receipt.type === 'bet' ? 'fa-bolt' : receipt.type === 'win' ? 'fa-trophy' : 'fa-times'}"></i>
                            ${actionText}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Render recipes (platform activity)
        function renderRecipes(filteredRecipes = recipes) {
            const container = document.getElementById('recipesContainer');
            
            if (filteredRecipes.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #65676b;">No platform activity yet!</div>';
                return;
            }
            
            container.innerHTML = filteredRecipes.map(recipe => {
                const timeAgo = getTimeAgo(new Date(recipe.timestamp));
                
                let iconClass = 'fa-circle';
                let actionClass = '';
                
                switch (recipe.type) {
                    case 'bet_placed':
                        iconClass = 'fa-bolt';
                        actionClass = 'receipt-bet';
                        break;
                    case 'bet_won':
                        iconClass = 'fa-trophy';
                        actionClass = 'receipt-win';
                        break;
                    case 'bet_lost':
                        iconClass = 'fa-times';
                        actionClass = 'receipt-lose';
                        break;
                    case 'account_created':
                        iconClass = 'fa-user-plus';
                        actionClass = 'receipt-bet';
                        break;
                    case 'market_viewed':
                        iconClass = 'fa-eye';
                        actionClass = '';
                        break;
                }
                
                return `
                    <div class="receipt-item">
                        <div class="receipt-time">${timeAgo}</div>
                        <div class="receipt-action ${actionClass}">
                            <i class="fas ${iconClass}"></i>
                            ${recipe.description}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Filter recipes
        function filterRecipes(type) {
            // Update filter buttons
            document.querySelectorAll('#recipesTab .filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            let filteredRecipes = recipes;
            
            switch (type) {
                case 'bets':
                    filteredRecipes = recipes.filter(r => r.type === 'bet_placed');
                    break;
                case 'wins':
                    filteredRecipes = recipes.filter(r => r.type === 'bet_won');
                    break;
                case 'losses':
                    filteredRecipes = recipes.filter(r => r.type === 'bet_lost');
                    break;
                case 'all':
                default:
                    filteredRecipes = recipes;
                    break;
            }
            
            renderRecipes(filteredRecipes);
        }

        // Filter markets
        function filterMarkets(category) {
            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const filteredMarkets = category === 'all' 
                ? markets.filter(m => m.category !== 'crypto')
                : markets.filter(m => (m.category || 'tech') === category);
            
            renderMarkets(filteredMarkets);
        }

        // Filter crypto markets
        function filterCrypto(timeframe) {
            document.querySelectorAll('#cryptoTab .filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // This would filter by timeframe in a real implementation
            loadCryptoMarkets();
        }

        // Update market stats
        function updateMarketStats() {
            document.getElementById('totalMarkets').textContent = markets.length;
            document.getElementById('activeBets').textContent = receipts.filter(r => r.type === 'bet').length;
            document.getElementById('totalVolume').textContent = receipts.reduce((sum, r) => sum + (r.amount || 0), 0) + ' BB';
        }

        // Search markets - All Markets tab
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            const filteredMarkets = markets.filter(market => 
                market.title.toLowerCase().includes(query) ||
                market.description.toLowerCase().includes(query)
            );
            
            // Re-paginate filtered results
            const startIndex = (currentPage - 1) * marketsPerPage;
            const endIndex = startIndex + marketsPerPage;
            const paginatedMarkets = filteredMarkets.slice(startIndex, endIndex);
            
            const marketsGrid = document.getElementById('allMarketsGrid');
            marketsGrid.innerHTML = renderMarketCards(paginatedMarkets);
            
            // Update pagination for filtered results
            const totalPages = Math.ceil(filteredMarkets.length / marketsPerPage);
            const paginationContainer = document.getElementById('allMarketsPagination');
            
            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `<button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                <i class="fas fa-chevron-left"></i> Previous
            </button>`;
            
            // Page numbers
            const startPage = Math.max(1, currentPage - 2);
            const endPage = Math.min(totalPages, currentPage + 2);
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `<button onclick="changePage(${i})" ${i === currentPage ? 'class="active"' : ''}>
                    ${i}
                </button>`;
            }
            
            // Next button
            paginationHTML += `<button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                Next <i class="fas fa-chevron-right"></i>
            </button>`;
            
            paginationContainer.innerHTML = paginationHTML;
        });

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.className = 'toast ' + type;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Helper function to get time ago
        function getTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) return 'Just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
            return `${Math.floor(diffInSeconds / 86400)}d ago`;
        }

        // Admin Panel Functions
        function openAdminPanel() {
            const modal = document.getElementById('adminModal');
            modal.classList.add('active');
            loadAdminAccounts();
        }

        function closeAdminPanel() {
            const modal = document.getElementById('adminModal');
            modal.classList.remove('active');
        }

        async function loadAdminAccounts() {
            try {
                const response = await fetch('http://localhost:3000/accounts');
                const data = await response.json();
                const adminList = document.getElementById('adminAccountsList');
                
                adminList.innerHTML = data.accounts.map(account => `
                    <div class="account-card">
                        <h3>👤 ${account.name.toUpperCase()}</h3>
                        <div class="account-info">
                            <strong>Balance:</strong> ${account.balance} BB
                        </div>
                        <div class="account-info">
                            <strong>Address:</strong> ${account.address.substring(0, 10)}...
                        </div>
                        <div class="account-actions">
                            <input type="number" id="amount_${account.name}" placeholder="Amount" min="1" style="width: 70%;">
                            <button onclick="addTokens('${account.name}')">Add</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Failed to load admin accounts:', error);
                showToast('Failed to load accounts for admin panel', 'error');
            }
        }

        async function addTokens(accountName) {
            const amountInput = document.getElementById(`amount_${accountName}`);
            const amount = parseInt(amountInput.value);
            
            if (!amount || amount < 1) {
                showToast('Please enter a valid amount', 'error');
                return;
            }
            
            try {
                const response = await fetch('http://localhost:3000/add-balance', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        account: accountName,
                        amount: amount
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(`Added ${amount} BB to ${accountName}`, 'success');
                    amountInput.value = '';
                    loadAdminAccounts(); // Refresh the list
                } else {
                    showToast(data.error || 'Failed to add tokens', 'error');
                }
            } catch (error) {
                console.error('Failed to add tokens:', error);
                showToast('Failed to add tokens to account', 'error');
            }
        }

        // Close admin modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('adminModal');
            if (event.target == modal) {
                closeAdminPanel();
            }
        }
    </script>
</body>
</html>